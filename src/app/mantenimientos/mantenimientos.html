<div class="container-fluid fade-in">
  
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="text-primary fw-bold">üîß Gesti√≥n de Mantenimientos</h2>
      <p class="text-muted">Reporte y seguimiento de fallos t√©cnicos.</p>
    </div>
    
    <div style="display: flex; gap: 10px;">
        <button (click)="exportarPDF()" style="background-color: #dc3545; color: white; border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; font-weight: bold;">
            üñ®Ô∏è Imprimir Reporte
        </button>
        <button class="btn btn-primary btn-lg shadow-sm" (click)="abrirModalReporte()">
            + Reportar Fallo
        </button>
    </div>
  </div>

  <div class="card shadow border-0">
    <div class="card-body p-0">
      <table class="table table-hover align-middle mb-0">
        <thead class="bg-light text-uppercase text-secondary small">
          <tr>
            <th class="ps-4 py-3">Equipo</th>
            <th>Fallo</th>
            <th>Fecha</th>
            <th>T√©cnico</th>
            <th class="text-center">Estado</th>
            <th class="text-end pe-4">Acci√≥n</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let m of listaMantenimientos">
            <td class="ps-4 fw-bold text-dark">{{ m.nombre_equipo }}</td>
            <td>{{ m.descripcion_fallo }}</td>
            <td>{{ m.fecha_reporte | date:'dd/MM/yyyy' }}</td>
            <td>{{ m.tecnico_asignado || 'Pendiente' }}</td>
            <td class="text-center">
                <span class="badge" [ngClass]="{
                    'bg-warning': m.estado === 'PENDIENTE',
                    'bg-info': m.estado === 'EN PROCESO',
                    'bg-success': m.estado === 'FINALIZADO'
                }">{{ m.estado }}</span>
            </td>
            <td class="text-end pe-4">
                <button *ngIf="m.estado !== 'FINALIZADO'" (click)="cambiarEstado(m, 'FINALIZADO')" class="btn btn-sm btn-outline-success">‚úÖ Finalizar</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="modal-overlay" *ngIf="mostrarModalReporte">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Nuevo Reporte de Fallo</h3>
            <button class="btn-close" (click)="cerrarModalReporte()">√ó</button>
        </div>
        <div class="modal-body">
            
            <div class="form-group mb-3">
                <label>Vincular a TDR (Obligatorio):</label>
                <select class="form-control" [(ngModel)]="nuevoReporte.id_tdr">
                    <option value="" disabled>-- Seleccione Contrato Marco --</option>
                    <option *ngFor="let t of listaTdrs" [value]="t.id_tdr">
                        {{ t.numero_tdr }} - {{ t.objeto_contratacion }}
                    </option>
                </select>
            </div>

            <div class="form-group mb-3">
                <label>Equipo:</label>
                <input class="form-control" [(ngModel)]="nuevoReporte.nombre_equipo" placeholder="Ej: Laptop HP">
            </div>

            <div class="form-group mb-3">
                <label>Descripci√≥n del Fallo:</label>
                <textarea class="form-control" [(ngModel)]="nuevoReporte.descripcion_fallo"></textarea>
            </div>

            <div class="form-group mb-3">
                <label>Adjuntar Informe (PDF):</label>
                <input type="file" class="form-control" accept="application/pdf" (change)="onFileSelected($event)">
            </div>

        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" (click)="cerrarModalReporte()">Cancelar</button>
            <button class="btn btn-primary" (click)="guardarReporte()">Guardar Reporte</button>
        </div>
    </div>
</div>